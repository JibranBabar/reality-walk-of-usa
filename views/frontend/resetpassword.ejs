<!DOCTYPE html>
<html lang="en">
<!-- include head -->
<%- include('../partials/front-inc/head.ejs') %>

    <body>
        <div class="modal-header border-0">
            <h3>Forgot Password Change</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form id="forgotPassword" onsubmit="return forgotPasswordHandler()" method="post" class="row">
                <div class="col-12">
                    <input type="password" class="form-control mb-3" id="password" name="password"
                        placeholder="New Password" required autocomplete="new-password" autofocus>
                </div>
                <div class="col-12">
                    <input type="password" class="form-control mb-3" id="password" name="password_confirmation"
                        placeholder="Confirm New Password" required autocomplete="password" autofocus>
                </div>
                <div class="col-12 d-flex justify-content-center text-danger" id="error_response_4">
                    <% if(typeof message !=='undefined' ){ %>
                        <span class="invalid-feedback" role="alert">
                            <strong>
                                <%= message %>
                            </strong>
                        </span>
                        <% } %>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Change password</button>
                </div>
            </form>
        </div>
        <!-- End Change password Modal -->
        <script>
            let url = window.location.href;
            let url_array = url.split('/');
            function forgotPasswordHandler() {
                event.preventDefault();
                $('#error_response_4').html('');
                let formData = $('#forgotPassword').serializeArray();
                var formObject = {};
                for (var i = 0; i < formData.length; i++) {
                    formObject[formData[i]['name']] = formData[i]['value'];
                }
                // let userData = JSON.parse(window.localStorage.getItem('user'));
                // formObject.user_id = userData._id;
                $.ajax({
                    type: "POST",
                    data: formObject,
                    url: "/auth/request-password/"+url_array[url_array.length-2]+'/'+url_array[url_array.length-1],
                    headers: {"Authorization": url_array[url_array.length-1]},
                    success: function (msg) {
                        if (msg.status === 'failed') {
                            $('#error_response_4').append(msg.message)
                        } else {
                            window.localStorage.setItem('forgootPassword', 1);
                            window.location.href = "/"
                        }
                    }
                })
                return true
            }
        </script>
        <!-- include Footer  -->
        <%- include('../partials/front-inc/footer.ejs') %>
    </body>

</html>