<!DOCTYPE html>
<html lang="en" dir="ltr">
<!-- include head -->
<%- include('../partials/admin-inc/head.ejs') %>

  <body class="header-fixed sidebar-fixed sidebar-dark header-light" id="body">
    <!-- WRAPPER -->
    <div class="wrapper">

      <!-- LEFT SIDEBAR WITH OUT FOOTER -->
      <%- include('../partials/admin-inc/asidebar.ejs') %>
        <!-- PAGE WRAPPER -->
        <div class="page-wrapper">

          <!-- Header -->
          <%- include('../partials/admin-inc/header.ejs') %>

            <!-- CONTENT WRAPPER -->
            <div class="content-wrapper">
              <div class="content">

                <div class="bg-white border rounded">
                  <div class="row no-gutters">
                    <div class="col-lg-4 col-xl-3">
                      <div class="profile-content-left profile-left-spacing pt-5 pb-3 px-3 px-xl-5">
                        <div class="card text-center widget-profile px-0 border-0">
                          <div class="card-img mx-auto rounded-circle">
                            <img src="/images/user/noimageicon.png" alt="user image">
                          </div>
                          <div class="card-body" style="width: max-content;">
                            <h4 class="py-2 text-dark"><span id="user_name4"></span></h4>
                          </div>
                        </div>
                        <hr class="w-100">
                        <div class="contact-info pt-4">
                          <h5 class="text-dark mb-1">Contact Information</h5>
                          <p class="text-dark font-weight-medium pt-4 mb-2">Email address</p>
                          <p><span id="user_email2"></span></p>
                          <p class="text-dark font-weight-medium pt-4 mb-2">Phone Number</p>
                          <p>+99 9539 2641 31</p>
                          <p class="text-dark font-weight-medium pt-4 mb-2">Social Profile</p>

                          <p class="pb-3 social-button">
                            <a href="#" class="mb-1 btn btn-outline btn-twitter rounded-circle">
                              <i class="mdi mdi-twitter"></i>
                            </a>
                            <a href="#" class="mb-1 btn btn-outline btn-linkedin rounded-circle">
                              <i class="mdi mdi-linkedin"></i>
                            </a>
                            <a href="#" class="mb-1 btn btn-outline btn-facebook rounded-circle">
                              <i class="mdi mdi-facebook"></i>
                            </a>
                            <a href="#" class="mb-1 btn btn-outline btn-skype rounded-circle">
                              <i class="mdi mdi-skype"></i>
                            </a>
                          </p>
                        </div>
                      </div>
                    </div>

                    <div class="col-lg-8 col-xl-9">
                      <div class="profile-content-right profile-right-spacing py-5">
                        <ul class="nav nav-tabs px-3 px-xl-5 nav-style-border" id="myTab" role="tablist">
                          <li class="nav-item">
                            <a class="nav-link active" id="settings-tab" data-toggle="tab" href="#settings" role="tab"
                              aria-controls="settings" aria-selected="false">Profile</a>
                          </li>
                        </ul>

                        <div class="tab-content px-3 px-xl-5" id="myTabContent">
                          <div class="tab-pane fade show active" id="settings" role="tabpanel"
                            aria-labelledby="settings-tab">
                            <div class="tab-pane-content mt-5">
                              <div class="form-group mb-4">
                                <label for="userName">User name</label>
                                <label type="text" class="form-control" id="userName"><span
                                    id="user_name5"></span></label>
                              </div>

                              <form id="updatePassword" onsubmit="return updatePasswordHandler()" method="post">
                                <div class="form-group mb-4">
                                  <label for="newPassword">New password</label>
                                  <input type="password" class="form-control" id="newpassword" name="password"
                                    placeholder="New Password" required autocomplete="new-password" autofocus>
                                </div>

                                <div class="form-group mb-4">
                                  <label for="conPassword">Confirm password</label>
                                  <input type="password" class="form-control" id="conpassword"
                                    name="password_confirmation" placeholder="Confirm New Password" required
                                    autocomplete="password" autofocus>
                                </div>
                                <div class="col-12 d-flex justify-content-center text-danger" id="error_response_upd">
                                  <% if(typeof message !=='undefined' ){ %>
                                    <span class="invalid-feedback" role="alert">
                                      <strong>
                                        <%= message %>
                                      </strong>
                                    </span>
                                    <% } %>
                                </div>

                                <div class="d-flex justify-content-end mt-5">
                                  <button type="submit" class="btn btn-primary mb-2 btn-pill">Update Pasword</button>
                                </div>
                              </form>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> <!-- End Content -->
            </div> <!-- End Content Wrapper -->
            <!-- include Footer  -->
            <%- include('../partials/admin-inc/footer.ejs') %>

        </div> <!-- End Page Wrapper -->

    </div> <!-- End Wrapper -->
  </body>

</html>

<script>
  function updatePasswordHandler() {
    event.preventDefault();
    $('#error_response_upd').html('');
    let formData = $('#updatePassword').serializeArray();
    var formObject = {};
    for (var i = 0; i < formData.length; i++) {
      formObject[formData[i]['name']] = formData[i]['value'];
    }
    let userData = JSON.parse(window.localStorage.getItem('user'));

    formObject.user_id = userData._id;
    $.ajax({
      type: "POST",
      data: formObject,
      url: "/auth/changepassword",
      success: function (msg) {
        if (msg.status === 'failed') {
          $('#error_response_upd').append(msg.message)
        } else {
          window.localStorage.setItem('UpdatePassword', 1);
          window.location.href = "/admin/admin-profile"
        }
      }
    })
    return true
  }
</script>