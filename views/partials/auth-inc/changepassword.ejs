<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content rounded-0 border-0 p-4">
            <div class="modal-header border-0">
                <h3>Change Password</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="changePassword" onsubmit="return changePasswordHandler()" method="post" class="row">
                    <div class="col-12">
                        <input type="password" class="form-control mb-3" id="password" name="password"
                            placeholder="New Password" required autocomplete="new-password" autofocus>
                    </div>
                    <div class="col-12">
                        <input type="password" class="form-control mb-3" id="password" name="password_confirmation"
                            placeholder="Confirm New Password" required autocomplete="password" autofocus>
                    </div>
                    <div class="col-12 d-flex justify-content-center text-danger" id="error_response_3">
                        <% if(typeof message !=='undefined' ){ %>
                            <span class="invalid-feedback" role="alert">
                                <strong>
                                    <%= message %>
                                </strong>
                            </span>
                            <% } %>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Change password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- End Change password Modal -->
<script>
    function changePasswordHandler() {
        event.preventDefault();
        $('#error_response_3').html('');
        let formData = $('#changePassword').serializeArray();
        var formObject = {};
        for (var i = 0; i < formData.length; i++) {
            formObject[formData[i]['name']] = formData[i]['value'];
        }
        let userData = JSON.parse(window.localStorage.getItem('user'));

        formObject.user_id = userData._id;
        $.ajax({
            type: "POST",
            data: formObject,
            url: "/auth/changepassword",
            success: function (msg) {
                if (msg.status === 'failed') {
                    $('#error_response_3').append(msg.message)
                } else {
                    window.localStorage.setItem('ChangePassword', 1);
                    window.location.href = "/"
                }
            }
        })
        return true
    }
</script>