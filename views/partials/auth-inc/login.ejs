<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content rounded-0 border-0 p-4">
            <div class="modal-header border-0">
                <h3>Login</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="loginform" onsubmit="return loginHandler()" method="post" class="row">
                    <div class="col-12">
                        <input type="email" class="form-control mb-3" id="email" name="email"
                            placeholder="Email Address" required autocomplete="email" autofocus>
                    </div>
                    <div class="col-12">
                        <input type="password" class="form-control mb-3" id="password" name="password"
                            placeholder="Password" required autocomplete="password" autofocus>
                    </div>
                    <div class="col-12 d-flex justify-content-center text-danger" id="error_response_1">
                        <% if(typeof message !=='undefined' ){ %>
                            <span class="invalid-feedback" role="alert">
                                <strong>
                                    <%= message %>
                                </strong>
                            </span>
                            <% } %>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary mb-3">LOGIN</button>
                    </div>
                </form>
                <div class="d-flex justify-content-between">
                    <div class="d-inline">
                        <a href="#forgotModal" data-toggle="modal" data-target="#forgotModal"
                            onclick="$('#loginModal').modal('hide')">Forgot password?</a>
                        <!-- <a href="/auth/forgetpassword">Forgot password?</a> -->
                    </div>
                    <div class="d-inline">Already registered
                        <a href="#signupModal" data-toggle="modal" data-target="#signupModal"
                            onclick="$('#loginModal').modal('hide')">Register</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Login Modal -->

<script>
    function loginHandler() {
        event.preventDefault();
        $('#error_response_1').html('');
        let formData = $('#loginform').serializeArray();
        var formObject = {};
        for (var i = 0; i < formData.length; i++) {
            formObject[formData[i]['name']] = formData[i]['value'];
        }
        $.ajax({
            type: "POST",
            data: formObject,
            url: "/auth/login",
            success: function (msg) {
                if (msg.status === 'failed') {
                    $('#error_response_1').append(msg.message)
                } else {
                    window.localStorage.setItem('token', msg.token);
                    window.localStorage.setItem('user', JSON.stringify(msg.data));
                    let userInfo = window.localStorage.getItem("user");
                    userInfo = JSON.parse(userInfo);
                    if (userInfo.is_admin == 1) {
                        window.localStorage.setItem('welcomeSA', 1);
                        window.location.href = "/admin/admin-dashboard"
                    } else if (userInfo.is_admin == 2) {
                        window.localStorage.setItem('adminlogin', 1);
                        window.location.href = "/admin/admin-admission-list"
                    } else {
                        window.localStorage.setItem('welcome', 1);
                        window.location.href = "/"
                    }
                }
            }
        })
        return true
    }
</script>